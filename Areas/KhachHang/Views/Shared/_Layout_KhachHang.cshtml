@{
    ViewData["Title"] = "LittleBeauty";
}

<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewData["Title"] - LittleBeauty</title>

    <link rel="icon" type="image/png" sizes="32x32" href="~/images/logomini.png">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Lobster:wght@400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="~/css/KhachHang/footer.css">
    <link rel="stylesheet" href="~/css/KhachHang/header.css">
    <link rel="stylesheet" href="~/css/KhachHang/chitiet-sanpham.css">
    <link rel="stylesheet" href="~/css/KhachHang/sanpham.css">
    <link rel="stylesheet" href="~/css/KhachHang/trangchu.css">
    <link rel="stylesheet" href="~/css/KhachHang/quanlitaikhoan.css">

  
    @RenderSection("Styles", required: false)  

</head>
<body class="bg-light">
    @Html.AntiForgeryToken()
    <!-- Header Section -->
    <header class="header-container">
        <nav class="main-navbar navbar navbar-expand-lg">
            <div class="container-fluid">
                <div style="padding-left: 20px;">
                <!-- Brand -->
                <a class="navbar-brand" asp-area="KhachHang" asp-controller="TrangChu" asp-action="Index">
                    <img src="~/logo.png" alt="LittleFish Beauty Logo">
                    LittleFish Beauty
                </a>
                </div>

                <!-- Mobile Toggle Button -->
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent" 
                        aria-controls="navbarContent" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Navbar Content -->
                <div class="collapse navbar-collapse" id="navbarContent">
                    <!-- Search Container -->
                    <div class="search-container">
                        <form class="search-form" asp-action="Index" asp-controller="SanPham" asp-area="KhachHang" method="get">
                            <div class="search-wrapper">
                                <input type="text" name="search" class="search-input" placeholder="Tìm kiếm sản phẩm..." value="@ViewBag.SearchQuery" autocomplete="off">
                                <button type="submit" class="search-btn">
                                    <i class="fas fa-search"></i>
                                </button>
                                <div class="search-suggestions" id="searchSuggestions"></div>
                            </div>
                        </form>
                    </div>

                    <!-- Navigation Links -->
                    <ul class="main-nav navbar-nav" style="padding-left: 15px;">
                        <li class="nav-item" style="padding-left:0px;">
                            <a class="nav-link" asp-area="KhachHang" asp-controller="TrangChu" asp-action="Index">
                                <i class="fas fa-home me-1"></i>Trang chủ
                            </a>
                        </li>
                        <li class="nav-item category-nav-item" style="padding-left:0px;" >
                            <!-- Category Dropdown will be loaded here -->
                            <div id="categoryDropdownContainer">
                                <div class="category-loading">
                                    <i class="fas fa-spinner fa-spin"></i>
                                    <span>Đang tải...</span>
                                </div>
                            </div>
                        </li>
                        <li class="nav-item" style="padding-left:0px;">
                            <a class="nav-link" asp-area="KhachHang" asp-controller="SanPham" asp-action="Index">
                                <i class="fas fa-shopping-bag me-1"></i>Sản phẩm
                            </a>
                        </li>

                    


                    <!-- User Actions -->
                    @if (User?.Identity?.IsAuthenticated == true)
                    {
                        <ul class="main-nav navbar-nav">
                        <!-- Đã đăng nhập -->
                        <div class="user-actions-logged">
                            <!-- User Dropdown - Fixed Bootstrap Implementation -->
                            <div class="dropdown">
                                <button class="btn btn-outline-primary dropdown-toggle" type="button" id="userDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                    <i class="fas fa-user me-1"></i>
                                    <span id="headerProfileName">@(User?.Identity?.Name ?? "Tài khoản")</span>
                                </button>
                                <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
                                    <li><a class="dropdown-item" asp-area="KhachHang" asp-controller="DiaChi" asp-action="Index">
                                        <i class="bi bi-bag-check me-2"></i>Địa chỉ của tôi</a>
                                    </li>
                                    <li><a class="dropdown-item" asp-area="KhachHang" asp-controller="DonHang" asp-action="Index">
                                        <i class="bi bi-bag-check me-2"></i>Đơn hàng của tôi</a>
                                    </li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li>
                                        <button type="button" class="dropdown-item text-danger" data-bs-toggle="modal" data-bs-target="#logoutModal">
                                            <i class="bi bi-box-arrow-right me-2"></i>Đăng Xuất
                                        </button>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        </ul>
                    }
                    else
                    {
                        <!-- Chưa đăng nhập -->
                        <div class="user-actions-guest" style="padding-left:30px;">
                            <a href="/DangNhap?returnUrl=@(Context.Request.Path + Context.Request.QueryString)" class="btn-login">
                                <i class="fas fa-sign-in-alt me-2"></i>Đăng nhập
                            </a>
                            <a href="@Url.Action("Index", "DangKi", new { area = "", returnUrl = Context.Request.Path + Context.Request.QueryString })" class="btn-register">
                                <i class="fas fa-user-plus me-1"></i>Đăng ký
                            </a>
                        </div>
                    }
                </div>
            </div>
        </nav>
    </header>

    @RenderBody()

    <!-- Logout Confirmation Modal -->
    <div class="modal fade logout-modal" id="logoutModal" tabindex="-1" aria-labelledby="logoutModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="logoutModalLabel">
                        <i class="fas fa-question-circle"></i>
                        Xác nhận đăng xuất
                    </h5>
                </div>
                <div class="modal-body">
                    <p>Bạn có chắc chắn muốn đăng xuất khỏi tài khoản hiện tại?</p>
                </div>
                <div class="" style="Display: flex; justify-content: space-between; padding: 20px;">
                    <button type="button" class="btn btn-cancel" data-bs-dismiss="modal">
                        <i class="fas fa-times me-1"></i>Hủy
                    </button>
                        <form asp-controller="DangNhap" asp-action="DangXuat" asp-area="" method="post" id="logoutForm">
                            @Html.AntiForgeryToken()
                            <button type="submit" class="btn btn-confirm"  id="confirmLogout">
                                <i class="fas fa-sign-out-alt "></i>Đăng xuất
                            </button>   
                       </form>
                </div>
            </div>
        </div>
    </div>

    
    <footer class="modern-footer">
        <!-- Decorative Wave -->
        <div class="footer-wave">
            <svg viewBox="0 0 1920 200" preserveAspectRatio="none">
                <!-- Sóng pastel xanh nhạt -->
                <path d="M0,0V46.29c47.79,22.2,103.59,32.17,158,28,70.36-5.37,136.33-33.31,206.8-37.5C438.64,32.43,512.34,53.67,583,72.05c69.27,18,138.3,24.88,209.4,13.08,36.15-6,69.85-17.84,104.45-29.34C989.49,25,1113-14.29,1200,52.47c87,66.76,174,100,280,80c106-20,212-80,320-60c108,20,216,100,320,80V0Z" opacity=".3" class="shape-fill" fill="rgba(200, 230, 201, 0.6)"></path>
                
                <!-- Sóng xanh lá cây -->
                <path d="M0,0V15.81C13,36.92,27.64,56.86,47.69,72.05,99.41,111.27,165,111,224.58,91.58c31.15-10.15,60.09-26.07,89.67-39.8,40.92-19,84.73-46,130.83-49.67,36.26-2.85,70.9,9.42,98.6,31.56,31.77,25.39,62.32,62,103.63,73,40.44,10.79,81.35-6.69,119.13-24.28s75.16-39,116.92-43.05c59.73-5.85,113.28,22.88,168.9,38.84c30.2,8.66,59,6.17,87.09-7.5c22.43-10.89,48-26.93,60.65-49.24c12.65,22.31,38.22,38.35,60.65,49.24c28.09,13.67,56.89,16.16,87.09,7.5c55.62-15.96,109.17-44.69,168.9-38.84c41.76,4.05,79.14,21.46,116.92,43.05c37.78,17.59,78.69,35.07,119.13,24.28c41.31-11,71.86-47.61,103.63-73c27.7-22.14,62.34-34.41,98.6-31.56c46.1,3.67,89.91,30.67,130.83,49.67c29.58,13.73,58.52,29.65,89.67,39.8C1755,111,1820.59,111.27,1872.31,72.05c19.05-15.19,34.69-35.13,47.69-56.24V0Z" opacity=".5" class="shape-fill" fill="rgba(129, 199, 132, 0.7)"></path>
                
                <!-- Sóng trắng trong suốt -->
                <path d="M0,0V5.63C149.93,59,314.09,71.32,475.83,42.57c43-7.64,84.23-20.12,127.61-26.46c59-8.63,112.48,12.24,165.56,35.4C827.93,77.22,886,95.24,951.2,90c86.53-7,172.46-45.71,248.8-84.81c76.34,39.1,162.27,77.81,248.8,84.81c65.2,5.24,123.27-12.78,182.2-38.49c53.08-23.16,106.56-44.03,165.56-35.4c43.38,6.34,84.61,18.82,127.61,26.46C1605.91,71.32,1770.07,59,1920,5.63V0Z" class="shape-fill" fill="rgba(255, 255, 255, 0.8)"></path>
            </svg>
        </div>

        <div class="footer-content">
            <div class="container">
                <div class="row g-4">
                    <!-- Brand Section -->
                    <div class="col-lg-4 col-md-6">
                        <div class="footer-brand">
                            <div class="brand-logo-section">
                                <div class="brand-logo-container">
                                    <img src="~/logo.png" alt="LittleFish Beauty Logo" class="footer-logo">
                                    <div class="logo-glow"></div>
                                </div>
                                <h3 class="brand-title">LittleFish Beauty</h3>
                            </div>
                            <p class="brand-description">
                                🌿 Mỹ phẩm thiên nhiên chất lượng cao, an toàn cho làn da của bạn.
                                Chúng tôi cam kết mang đến những sản phẩm làm đẹp từ thiên nhiên,
                                được nghiên cứu kỹ lưỡng và kiểm tra chất lượng nghiêm ngặt.
                            </p>
                            <div class="brand-motto">
                                <span class="motto-icon">✨</span>
                                <em>"Vẻ đẹp tự nhiên, sự tự tin trong chính bạn"</em>
                            </div>

                            <!-- Social Media -->
                            <div class="social-media">
                                <h6 class="social-title">Kết nối với chúng tôi</h6>
                                <div class="social-links">
                                    <a href="#" class="social-link facebook" title="Facebook">
                                        <i class="fab fa-facebook-f"></i>
                                        <span class="social-tooltip">Facebook</span>
                                    </a>
                                    <a href="#" class="social-link instagram" title="Instagram">
                                        <i class="fab fa-instagram"></i>
                                        <span class="social-tooltip">Instagram</span>
                                    </a>
                                    <a href="#" class="social-link youtube" title="YouTube">
                                        <i class="fab fa-youtube"></i>
                                        <span class="social-tooltip">YouTube</span>
                                    </a>
                                    <a href="#" class="social-link tiktok" title="TikTok">
                                        <i class="fab fa-tiktok"></i>
                                        <span class="social-tooltip">TikTok</span>
                                    </a>
                                    <a href="#" class="social-link zalo" title="Zalo">
                                        <i class="fas fa-comments"></i>
                                        <span class="social-tooltip">Zalo</span>
                                    </a>
                                </div>
                                

                                    <div class="trust-badges" style="padding-top: 10px; justify-content: flex-start;">
                                        <span class="trust-badge">
                                            <i class="fas fa-shield-check"></i>
                                            Bảo mật SSL
                                        </span>
                                        <span class="trust-badge">
                                            <i class="fas fa-award"></i>
                                            Chất lượng đảm bảo
                                        </span>
                                        <span class="trust-badge">
                                            <i class="fas fa-leaf"></i>
                                            100% Thiên nhiên
                                        </span>
                                    </div>

                            </div>
                        </div>
                    </div>

                    <!-- Product Categories -->
                    <div class="col-lg-3 col-md-6">
                        <div class="footer-section">
                            <h5 class="footer-heading">
                                <i class="fas fa-leaf me-2"></i>Danh Mục Sản Phẩm
                            </h5>
                            <ul class="footer-links">
                                <li>
                                    <a asp-area="KhachHang" asp-controller="SanPham" asp-action="Index" asp-route-category="skincare">
                                        <i class="fas fa-spa"></i>Chăm sóc da
                                        <span class="link-count">(24)</span>
                                    </a>
                                </li>
                                <li>
                                    <a asp-area="KhachHang" asp-controller="SanPham" asp-action="Index" asp-route-category="makeup">
                                        <i class="fas fa-palette"></i>Trang điểm
                                        <span class="link-count">(18)</span>
                                    </a>
                                </li>
                                <li>
                                    <a asp-area="KhachHang" asp-controller="SanPham" asp-action="Index" asp-route-category="haircare">
                                        <i class="fas fa-cut"></i>Dưỡng tóc
                                        <span class="link-count">(12)</span>
                                    </a>
                                </li>
                                <li>
                                    <a asp-area="KhachHang" asp-controller="SanPham" asp-action="Index" asp-route-category="suncare">
                                        <i class="fas fa-sun"></i>Chống nắng
                                        <span class="link-count">(8)</span>
                                    </a>
                                </li>
                                <li>
                                    <a asp-area="KhachHang" asp-controller="SanPham" asp-action="Index" asp-route-category="essential-oils">
                                        <i class="fas fa-seedling"></i>Tinh dầu
                                        <span class="link-count">(6)</span>
                                    </a>
                                </li>
                                <li>
                                    <a asp-area="KhachHang" asp-controller="SanPham" asp-action="Index" asp-route-category="body-care">
                                        <i class="fas fa-heart"></i>Chăm sóc cơ thể
                                        <span class="link-count">(15)</span>
                                    </a>
                                </li>
                                <li class="featured-link">
                                    <a asp-area="KhachHang" asp-controller="SanPham" asp-action="Index" asp-route-isNew="true">
                                        <i class="fas fa-star"></i>Sản phẩm mới
                                        <span class="new-badge">Hot</span>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>

                    <!-- Customer Service -->
                    <div class="col-lg-2 col-md-6">
                        <div class="footer-section">
                            <h5 class="footer-heading">
                                <i class="fas fa-headset me-2"></i>Hỗ Trợ
                            </h5>
                            <ul class="footer-links">
                                <li><a href="#" data-feature="order-guide"><i class="fas fa-question-circle"></i>Hướng dẫn đặt hàng</a></li>
                                <li><a href="#" data-feature="return-policy"><i class="fas fa-exchange-alt"></i>Chính sách đổi trả</a></li>
                                <li><a href="#" data-feature="privacy-policy"><i class="fas fa-shield-alt"></i>Chính sách bảo mật</a></li>
                                <li><a href="#" data-feature="shipping"><i class="fas fa-truck"></i>Vận chuyển</a></li>
                                <li><a href="#" data-feature="payment"><i class="fas fa-credit-card"></i>Thanh toán</a></li>
                                <li><a href="#" data-feature="member-benefits"><i class="fas fa-gift"></i>Ưu đãi thành viên</a></li>
                            </ul>
                        </div>
                    </div>

                    <!-- Contact Info -->
                    <div class="col-lg-3 col-md-6">
                        <div class="footer-section">
                            <h5 class="footer-heading">
                                <i class="fas fa-map-marker-alt me-2"></i>Thông Tin Liên Hệ
                            </h5>
                            <div class="contact-info">
                                <div class="contact-item">
                                    <div class="contact-icon">
                                        <i class="fas fa-map-marker-alt"></i>
                                    </div>
                                    <div class="contact-details">
                                        <strong>Địa chỉ:</strong>
                                        <p>90 Đ.13, Tân Quy, Quận 7<br>Thành phố Hồ Chí Minh</p>
                                    </div>
                                </div>

                                <div class="contact-item">
                                    <div class="contact-icon">
                                        <i class="fas fa-phone"></i>
                                    </div>
                                    <div class="contact-details">
                                        <strong>Hotline:</strong>
                                        <p><a href="tel:0388442230">038 844 2230</a></p>
                                        <small>Thứ 2 - Chủ nhật: 8:00 - 22:00</small>
                                    </div>
                                </div>

                                <div class="contact-item">
                                    <div class="contact-icon">
                                        <i class="fas fa-envelope"></i>
                                    </div>
                                    <div class="contact-details">
                                        <strong>Email:</strong>
                                        <p><a href="mailto:mr.nghiaenglish2230@littlefish.com">mr.nghiaenglish2230@littlefish.com</a></p>
                                    </div>
                                </div>

                                <div class="contact-item">
                                    <div class="contact-icon">
                                        <i class="fas fa-users"></i>
                                    </div>
                                    <div class="contact-details">
                                        <strong>Tác giả:</strong>
                                        <p><a class="" asp-area="KhachHang" asp-controller="About" asp-action="Index"  class="author-link">LittleFish Beauty Team</a></p>
                                        <small>Đội ngũ chuyên gia làm đẹp</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer Bottom -->
        <div class="footer-bottom">
            <div class="container">
                <div class="footer-bottom-content" style="justify-content: space-around;">
                    <div class="row align-items-center">
                        <div class="col-md-12">
                            <div class="copyright">
                                <p class="mb-0">
                                    <i class="fas fa-copyright me-1"></i>
                                    <strong>2025 LittleFish Beauty.</strong>
                                    Tất cả quyền được bảo lưu.
                                </p>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>

        <!-- Floating Elements -->
        <div class="footer-floating-elements">
            <div class="floating-leaf leaf-1">🌿</div>
            <div class="floating-leaf leaf-2">🍃</div>
            <div class="floating-leaf leaf-3">🌱</div>
            <div class="floating-flower flower-1">🌸</div>
            <div class="floating-flower flower-2">🌺</div>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    

    <!-- Header JavaScript -->
    <script>
        // Global variable to track if categories are loaded
        let categoriesLoaded = false;

        // Load categories on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Load categories immediately for better UX
            loadCategories();

            // ...existing code...
        });

        // Load categories function
        function loadCategories() {
            if (categoriesLoaded) return;

            fetch('@Url.Action("GetCategories", "TrangChu", new { area = "KhachHang" })')
                .then(response => response.text())
                .then(html => {
                    document.getElementById('categoryDropdownContainer').innerHTML = html;
                    categoriesLoaded = true;
                    
                    // Initialize Bootstrap dropdown after loading
                    const dropdownElement = document.querySelector('#categoryDropdown');
                    if (dropdownElement) {
                        new bootstrap.Dropdown(dropdownElement);
                    }
                })
                .catch(error => {
                    console.error('Error loading categories:', error);
                    // Show fallback UI
                    document.getElementById('categoryDropdownContainer').innerHTML = `
                        <a class="nav-link" href="@Url.Action("Index", "SanPham", new { area = "KhachHang" })">
                            <i class="fas fa-th-large me-1"></i>Danh Mục
                        </a>
                    `;
                });
        }

        // Legacy function for backwards compatibility
        function loadCategoryDropdown() {
            loadCategories();
        }

        // Search functionality with suggestions
        document.addEventListener('DOMContentLoaded', function() {
            const searchForm = document.querySelector('.search-form');
            const searchInput = document.querySelector('.search-input');
            const suggestionsContainer = document.getElementById('searchSuggestions');
            let searchTimeout;
            let selectedIndex = -1;
            let currentSuggestions = [];
            
            if (searchForm && searchInput && suggestionsContainer) {
                // Form submit handler
                searchForm.addEventListener('submit', function(e) {
                    const query = searchInput.value.trim();
                    if (!query) {
                        e.preventDefault();
                        searchInput.focus();
                        return false;
                    }
                    hideSuggestions();
                });

                // Search input handler for suggestions
                searchInput.addEventListener('input', function() {
                    const query = this.value.trim();
                    selectedIndex = -1;
                    
                    clearTimeout(searchTimeout);
                    
                    if (query.length >= 1) { // Show suggestions from first character
                        showLoadingState();
                        searchTimeout = setTimeout(() => {
                            fetchSearchSuggestions(query);
                        }, 200); // Reduced delay for better UX
                    } else {
                        hideSuggestions();
                    }
                });

                // Handle keyboard navigation
                searchInput.addEventListener('keydown', function(e) {
                    const suggestions = suggestionsContainer.querySelectorAll('.suggestion-item');
                    
                    if (e.key === 'ArrowDown') {
                        e.preventDefault();
                        selectedIndex = Math.min(selectedIndex + 1, suggestions.length - 1);
                        updateSelectedSuggestion(suggestions);
                        scrollToSelected();
                    } else if (e.key === 'ArrowUp') {
                        e.preventDefault();
                        selectedIndex = Math.max(selectedIndex - 1, -1);
                        updateSelectedSuggestion(suggestions);
                        scrollToSelected();
                    } else if (e.key === 'Enter') {
                        if (selectedIndex >= 0 && suggestions[selectedIndex]) {
                            e.preventDefault();
                            selectSuggestion(suggestions[selectedIndex]);
                        }
                    } else if (e.key === 'Escape') {
                        hideSuggestions();
                        selectedIndex = -1;
                        searchInput.blur();
                    }
                });

                // Hide suggestions when clicking outside
                document.addEventListener('click', function(e) {
                    if (!e.target.closest('.search-container')) {
                        hideSuggestions();
                        selectedIndex = -1;
                    }
                });

                // Show suggestions when focusing on input (if has value)
                searchInput.addEventListener('focus', function() {
                    const query = this.value.trim();
                    if (query.length >= 1 && currentSuggestions.length > 0) {
                        showSuggestions();
                    }
                });
            }

            // Show loading state
            function showLoadingState() {
                suggestionsContainer.innerHTML = `
                    <div class="suggestion-loading">
                        <i class="fas fa-spinner fa-spin me-2"></i>
                        <span>Đang tìm kiếm...</span>
                    </div>
                `;
                suggestionsContainer.style.display = 'block';
            }

            // Fetch search suggestions with improved error handling
            function fetchSearchSuggestions(query) {
                const encodedQuery = encodeURIComponent(query);
                const url = `@Url.Action("SearchSuggestions", "SanPham", new { area = "KhachHang" })?term=${encodedQuery}`;
                
                fetch(url, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    }
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    currentSuggestions = data || [];
                    displaySuggestions(currentSuggestions, query);
                })
                .catch(error => {
                    console.error('Error fetching suggestions:', error);
                    showNoResults();
                });
            }

            // Display search suggestions with highlighting
            function displaySuggestions(suggestions, query) {
                if (!suggestions || suggestions.length === 0) {
                    showNoResults();
                    return;
                }

                let html = '';
                suggestions.forEach((item, index) => {
                    const imageUrl = item.image || '/images/no-image.png';
                    const price = item.price ? new Intl.NumberFormat('vi-VN', { 
                        style: 'currency', 
                        currency: 'VND' 
                    }).format(item.price) : 'Liên hệ';
                    
                    // Highlight matching text
                    const highlightedName = highlightText(item.name || '', query);
                    
                    html += `
    <div class="suggestion-item" data-url="${item.url || '#'}" data-name="${item.name || ''}" data-index="${index}">
        <!-- Ẩn ảnh sản phẩm -->
        <!--<div class="suggestion-image">
            <img src="${imageUrl}" alt="${item.name || 'Sản phẩm'}" 
                 onerror="this.src='/images/no-image.png'">
        </div>-->
        <div class="suggestion-content">
            <div class="suggestion-name">${highlightedName}</div>
            <div class="suggestion-meta">
                <span class="suggestion-category">${item.category || 'Chưa phân loại'}</span>
                <span class="suggestion-price">${price}</span>
            </div>
        </div>
    </div>
`;
                });

                suggestionsContainer.innerHTML = html;
                suggestionsContainer.style.display = 'block';
                selectedIndex = -1;

                // Add click handlers
                suggestionsContainer.querySelectorAll('.suggestion-item').forEach((item, index) => {
                    item.addEventListener('click', function(e) {
                        e.preventDefault();
                        selectSuggestion(this);
                    });

                    item.addEventListener('mouseenter', function() {
                        selectedIndex = index;
                        updateSelectedSuggestion(suggestionsContainer.querySelectorAll('.suggestion-item'));
                    });
                });
            }

            // Highlight matching text
            function highlightText(text, query) {
                if (!text || !query) return text;
                
                try {
                    // Remove Vietnamese diacritics for comparison
                    const normalizedText = removeDiacritics(text.toLowerCase());
                    const normalizedQuery = removeDiacritics(query.toLowerCase());
                    
                    if (normalizedText.includes(normalizedQuery)) {
                        // Find the position in the original text
                        let start = 0;
                        let result = '';
                        let remaining = text;
                        
                        while (remaining) {
                            const normalizedRemaining = removeDiacritics(remaining.toLowerCase());
                            const index = normalizedRemaining.indexOf(normalizedQuery);
                            
                            if (index === -1) {
                                result += remaining;
                                break;
                            }
                            
                            // Add text before match
                            result += remaining.substring(0, index);
                            
                            // Add highlighted match
                            const matchedText = remaining.substring(index, index + query.length);
                            result += `<mark class="search-highlight">${matchedText}</mark>`;
                            
                            // Continue with remaining text
                            remaining = remaining.substring(index + query.length);
                        }
                        
                        return result;
                    }
                } catch (e) {
                    console.error('Error highlighting text:', e);
                }
                
                return text;
            }

            // Simple diacritics removal for client-side
            function removeDiacritics(str) {
                return str.normalize('NFD')
                         .replace(/[\u0300-\u036f]/g, '')
                         .replace(/đ/g, 'd')
                         .replace(/Đ/g, 'D');
            }

            // Show no results message
            function showNoResults() {
                suggestionsContainer.innerHTML = `
                    <div class="no-suggestions">
                        <i class="fas fa-search me-2 text-muted"></i>
                        <span>Chưa tìm thấy sản phẩm nào</span>
                    </div>
                `;
                suggestionsContainer.style.display = 'block';
                currentSuggestions = [];
            }

            // Update selected suggestion visual state
            function updateSelectedSuggestion(suggestions) {
                suggestions.forEach((item, index) => {
                    if (index === selectedIndex) {
                        item.classList.add('selected');
                    } else {
                        item.classList.remove('selected');
                    }
                });
            }

            // Scroll to selected suggestion
            function scrollToSelected() {
                const selectedItem = suggestionsContainer.querySelector('.suggestion-item.selected');
                if (selectedItem) {
                    selectedItem.scrollIntoView({
                        block: 'nearest',
                        behavior: 'smooth'
                    });
                }
            }

            // Select a suggestion
            function selectSuggestion(suggestionElement) {
                const productName = suggestionElement.dataset.name;
                const productUrl = suggestionElement.dataset.url;
                
                if (productUrl && productUrl !== '#') {
                    // Navigate to product detail page
                    window.location.href = productUrl;
                } else {
                    // Fallback to search
                    searchInput.value = productName;
                    hideSuggestions();
                    searchForm.submit();
                }
            }

            // Show suggestions
            function showSuggestions() {
                if (currentSuggestions.length > 0) {
                    suggestionsContainer.style.display = 'block';
                }
            }

            // Hide suggestions
            function hideSuggestions() {
                suggestionsContainer.style.display = 'none';
                selectedIndex = -1;
            }

            // Load cart count
            loadCartCount();
            
            // Initialize Bootstrap dropdowns
            const dropdownElements = document.querySelectorAll('.dropdown-toggle');
            dropdownElements.forEach(function(element) {
                new bootstrap.Dropdown(element);
            });

            // Logout confirmation handler
            const confirmLogoutBtn = document.getElementById('confirmLogout');
            const logoutForm = document.getElementById('logoutForm');
            const logoutModal = document.getElementById('logoutModal');
            
            if (confirmLogoutBtn && logoutForm) {
                confirmLogoutBtn.addEventListener('click', function() {
                    // Hide modal first
                    const modal = bootstrap.Modal.getInstance(logoutModal);
                    if (modal) {
                        modal.hide();
                    }
                    
                    // Submit logout form after modal is hidden
                    setTimeout(() => {
                        logoutForm.submit();
                    }, 300);
                });
            }
        });

        // Load cart count from session via API
        function loadCartCount() {
            const cartCount = document.getElementById('cartCount');
            if (cartCount) {
                // Gọi API để lấy số lượng sản phẩm trong giỏ hàng từ session
                fetch('@Url.Action("GetCartCount", "Cart", new { area = "KhachHang" })')
                    .then(response => response.json())
                    .then(data => {
                        const count = data.cartCount || 0;
                        cartCount.textContent = count;
                        localStorage.setItem('cartCount', count);
                        
                        // Hide badge if count is 0
                        if (count === 0) {
                            cartCount.style.display = 'none';
                        } else {
                            cartCount.style.display = 'inline';
                        }
                    })
                    .catch(error => {
                        console.error('Error loading cart count:', error);
                        // Fallback to localStorage
                        const count = localStorage.getItem('cartCount') || '0';
                        cartCount.textContent = count;
                        
                        if (count === '0') {
                            cartCount.style.display = 'none';
                        } else {
                            cartCount.style.display = 'inline';
                        }
                    });
            }
        }

        // Update cart count
        function updateCartCount(count) {
            const cartCount = document.getElementById('cartCount');
            if (cartCount) {
                cartCount.textContent = count;
                localStorage.setItem('cartCount', count);
                
                if (count === 0 || count === '0') {
                    cartCount.style.display = 'none';
                } else {
                    cartCount.style.display = 'inline';
                }
            }
        }

        // Mobile search toggle
        function toggleMobileSearch() {
            const searchContainer = document.querySelector('.search-container');
            if (searchContainer) {
                searchContainer.style.display = searchContainer.style.display === 'none' ? 'block' : 'none';
            }
        }
    </script>
    

    <script src="~/js/Login/quanlitaikhoan.js"></script>
    <script src="~/js/Khachang/quanlitaikhoan.js"></script>
    <script src="~/js/KhachHang/chitiet-sanpham.js"></script>
    <script src="~/js/KhachHang/giohang.js"></script>
    <script src="~/js/KhachHang/quanlitaikhoan.js"></script>
    <script src="~/js/KhachHang/sanpham.js"></script>
    <script src="~/js/KhachHang/thanhtoan.js"></script>
    <script src="~/js/KhachHang/trangchu.js"></script>
    <script src="~/js/KhachHang/about.js"></script>
    <script src="~/js/KhachHang/footer.js"></script>
    @RenderSection("Scripts", required: false)
</body>
</html>

